//
// EPITECH PROJECT, 2018
// cpp_arcade
// File description:
// ncurses constructor
//

#include <cstddef>
#include <iostream>
#include <string>
#include <string.h>
#include <SFML/Window.hpp>
#include <SFML/Graphics.hpp>
#include <SFML/Audio.hpp>
#include "Board.hpp"
#include "Utils.hpp"
#include "Lsfml.hpp"
#include "Errors.hpp"

Lsfml::Lsfml()
	: _window(sf::VideoMode(800, 600), "Arcade"), _buffer(), _sound()/*,
	_start_game_x(0),
	_start_game_y(0)*/
{
	_window.setFramerateLimit(60);
	/*if ((_window = initscr()) == nullptr
	|| (raw() == ERR)
	|| (noecho()) == ERR
	|| (keypad(stdscr, 1)) == ERR)
	throw new GraphicalInitError("Error in Ncurses init\n");*/
}

Lsfml::~Lsfml()
{
}

/*
** TODO   Trouver un bypass pour throw on endwin error
**
**	if ((endwin()) == ERR)
**		throw new GraphicalCleanupError("Error on Ncurses exit\n");
 */
 

void	Lsfml::clear()
{
	_window.clear(sf::Color::Black);
}

void	Lsfml::playSound(const std::string &path)
{
	try
	{
		if (_buffer.loadFromFile(path) == false)
			throw std::string("loadFromFile: couldn't load sound\n");
		else {
			_sound.setBuffer(_buffer);
			_sound.play();
			_sound.setLoop(true);
		}
	} catch(std::string const &str) {
		throw new GraphicalInLibError(str, "SFML");
	}
}

void	Lsfml::stopSound(const std::string &path)
{
	_sound.stop();
}

/*
void	Lsfml::drawDisp(Disp &disp)
{
	try {
		Position st = std::make_pair((size_t) std::get<0> (disp.position),
		(size_t) std::get<1> (disp.position));

		_moveCursor(st);
		printw("%c", disp.character);
	} catch (const GraphicalInLibError &e) {
		std::string str(e.what());
		throw new GraphicalInLibError(str + "\nError on drawing Disp character\n", e.getComponent());
	}
}


void	Lsfml::drawButton(Button &button)
{
	try {
		Position st = std::make_pair((size_t) std::get<0> (button.pos),
		(size_t) std::get<1> (button.pos));

		_moveCursor(st);	
		printw("%s", button.text.c_str());
	} catch (const GraphicalInLibError &e) {
		std::string str(e.what());
		throw new GraphicalInLibError(str + "\nError on drawing button\n", "Ncurses");
	}
}

void	drawScene(Scene &scene)
{
	try {

	} catch (const GraphicalInLibError &e) {
		std::string str(e.what());
		throw new GraphicalInLibError(str + "\nError on drawing scene\n", e.getComponent());
	}
}

char	Lsfml::getKey()
{
	char ret;

	if ((ret = getch()) == ERR)
		throw new GraphicalInLibError("Error in retrieving user input key\n");
	return ret;
}
*/

void    Lsfml::drawText(Text &text)
{
	
	_moveCursor(text.pos);
	_print_text(text.text);
	_refreshScreen();
}

/*
void    Lsfml::_moveCursor(Position pos)
{
	if ((move((int) std::get<0> (pos), (int) std::get<1> (pos))) == ERR)
		throw new GraphicalInLibError("Error in moving the pointer to print in Ncurses\n");
}

void    Lsfml::_refreshScreen()
{
	if ((refresh()) == ERR)
		throw new GraphicalInLibError("Error in refreshing Ncurses\n");
}

void    Lsfml::_print_text(std::string text)
{
	if ((printw("%s", text.c_str())) == ERR)
		throw new GraphicalInLibError("Error in printing in Ncurses\n");
}
 */
